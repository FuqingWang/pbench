<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2018-05-11 Fri 19:30 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PBench server installation</title>
<meta name="generator" content="Org mode" />
<meta name="keywords" content="pbench" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" href="../../stylesheets/normalize.css" type="text/css"/>
<link rel="stylesheet" href="../../stylesheets/stylesheet.css" type="text/css"/>
<link rel="stylesheet" href="../../stylesheets/github-light.css" type="text/css"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">PBench server installation</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgec995fa">Introduction</a></li>
<li><a href="#orgc315959">Overview</a></li>
<li><a href="#org38beb64">Prerequisites</a></li>
<li><a href="#orgb6bdb74">Server installation (generic)</a>
<ul>
<li><a href="#org6075d59">Installing the RPM</a></li>
<li><a href="#orgab5bad0">Customizing the installation with the local settings.</a></li>
<li><a href="#org1911386">Config files</a></li>
<li><a href="#orgbfcd65e">The rest of the setup</a></li>
</ul>
</li>
<li><a href="#orgcf6b88b">Testing</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgec995fa" class="outline-2">
<h2 id="orgec995fa">Introduction</h2>
<div class="outline-text-2" id="text-orgec995fa">
<p>
Server installation is done through two packages: an externally
available, upstream package containing all the relevant scripts and an
internal package that contains the local configuration files<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup>. The
upstream bits include a script that the internal package calls to
install the local config files in the appropriate places. It also
creates a crontab from the information in the configuration files
which needs to be installed manually and creates the top level
directories needed to store results.
</p>

<p>
The server RPM consists of the scripts that are run (currently from cron)
on the server side: they include scripts to check, unpack and archive the
incoming tarballs, reorganize the results hierarchy, index the results into
ElasticSearch, etc.
</p>

<p>
In addition to the generic bits, some localization is needed. This is
discussed in some detail below.
</p>
</div>
</div>

<div id="outline-container-orgc315959" class="outline-2">
<h2 id="orgc315959">Overview</h2>
<div class="outline-text-2" id="text-orgc315959">
<p>
A user running the pbench agent produces results that are stored
locally, until the user calls <code>pbench-move-results</code>. The results are then
packaged up as a compressed tarball which is copied to the server.
Once there, the server scripts are run through <code>cron</code> to unpack
the tarball and store the results for later visualization. Additional
processing (which is not described in this document any further) might
include indexing results, creating backups of the tarballs, and sending
sosreports on to other services for further processing.
</p>
</div>
</div>

<div id="outline-container-org38beb64" class="outline-2">
<h2 id="org38beb64">Prerequisites</h2>
<div class="outline-text-2" id="text-org38beb64">
<p>
The host that runs the server has to run apache. It should also
have a fairly hefty filesystem for storing results. Of course, the
more results you produce, the bigger the filesystem should be.
</p>

<p>
In our setup, we have a machine that runs apache and mounts a 27TB
gluster volume on /pbench. For experimental purposes, a filesystem
on a SATA/SAS disk with capacity of a few TB should be more than enough.
</p>

<p>
In addition, we index the results into ElasticSearch. This setup
is beyond the scope of this document.
</p>

<p>
If your local pbench admins provide an "internal" RPM available, you should use it
for installation: it takes care of the drudgery of installing the "external" RPM
and then customizing the installation with the local settings.
</p>

<p>
If there is no "internal" RPM available, install the "external" RPM (see <a href="#orgb6bdb74">here</a> for details).
You will then have to customize the installation by hand (see <a href="#orgab5bad0">here</a> for details).
</p>
</div>
</div>

<div id="outline-container-orgb6bdb74" class="outline-2">
<h2 id="orgb6bdb74">Server installation (generic)</h2>
<div class="outline-text-2" id="text-orgb6bdb74">
</div>
<div id="outline-container-org6075d59" class="outline-3">
<h3 id="org6075d59">Installing the RPM</h3>
<div class="outline-text-3" id="text-org6075d59">
<p>
The repo is the standard <a href="https://copr.fedorainfracloud.org/coprs/ndokos/pbench/">COPR pbench repo</a>, installed with
</p>
<pre class="example">
dnf copr enable ndokos/pbench
</pre>
<p>
or manually if dnf is not available - see the <a href="https://copr.fedorainfracloud.org/coprs/ndokos/pbench/">COPR pbench page</a> for instructions.
</p>

<p>
The server is installed normally:
</p>
<pre class="example">
dnf install pbench-server
# or
# yum install pbench-server
</pre>
<p>
That creates a <code>pbench</code> user with home directory <code>/home/pbench</code> if not
present already. The server bits can be installed anywhere, but the
default location is <code>/opt/pbench-server</code>: scripts under
<code>/opt/pbench-server/bin</code>, libraries, config files, crontabs under
<code>/opt/pbench-server/lib</code>.
</p>
</div>
</div>

<div id="outline-container-orgab5bad0" class="outline-3">
<h3 id="orgab5bad0">Customizing the installation with the local settings.</h3>
<div class="outline-text-3" id="text-orgab5bad0">
<p>
The home directory of the <code>pbench</code> user is only used for ssh purposes:
the public key of the <code>pbench agent</code> is copied in to allow <code>pbench-move-results</code>
to be able to copy tarballs to the server without requiring a password.
</p>

<p>
The installation directory (<code>/opt/pbench-server</code> by default) holds all
the scripts, config files and the crontab. There may be more than one
config file, depending on what services the server provides, but this
document only describes the basic setup of the server, for which the
config file is <code>/opt/pbench-server/lib/config/pbench-server.cfg</code>.
</p>
</div>
</div>

<div id="outline-container-org1911386" class="outline-3">
<h3 id="org1911386">Config files</h3>
<div class="outline-text-3" id="text-org1911386">
<p>
Example config files are installed under <code>/opt/pbench-server/lib/config</code>. You should
make copies of these files:
</p>
<pre class="example">
cp pbench-server.cfg.example pbench-server.cfg
cp pbench-index.cfg.example pbench-index.cfg
</pre>
<p>
and modify them appropriately (<code>pbench-index.cfg</code> is optional - see
below). The minimal changes required are marked with <code># CHANGE ME</code>
comments: basically, hostnames and e-mail addresses will need to be
modified for your environment.
</p>

<p>
In addition, you will need to decide which roles and tasks to enable
under cron.  The default roles are <code>pbench-results</code> and
<code>pbench-backup</code>.
</p>

<p>
The <code>pbench-results</code> role consists of a number of tasks: unpacking
incoming tarballs (task <code>pbench-unpack-tarballs</code>), copying sosreports
(task <code>pbench-copy-sosreports</code>), indexing metadata (and real-soon-now
results) into ElasticSearch (task <code>pbench-index</code>) and reorganizing
results on user demand (task <code>pbench-edit-prefixes</code>). The minimal set
is unpacking the tarballs and reorganizing results. The rest are
optional and not covered in this document. In particular, if you don't
run the <code>pbench-index</code> task, you don't need to worry about the
<code>pbench-index.cfg</code> file above.
</p>

<p>
The <code>pbench-backup</code> role consists of two tasks: actually backing up the
tarballs (task <code>pbench-backup-tarballs</code>) and verifying the integrity
of the tarballs (task <code>pbench-verify-tarballs</code>).
</p>

<p>
You might want to save the config file(s) in some safe place for future
reference. If you need to reinstall the <code>pbench-server</code> RPM, you can
then just generate the rest of the setup from the saved config file
as described in the next section.
</p>
</div>
</div>

<div id="outline-container-orgbfcd65e" class="outline-3">
<h3 id="orgbfcd65e">The rest of the setup</h3>
<div class="outline-text-3" id="text-orgbfcd65e">
<p>
Let us assume you now have a saved <code>pbench-server.cfg</code> file in some
safe place. The rest of the setup goes as follows:
</p>
<pre class="example">
PATH=/opt/pbench-server/bin:$PATH
pbench-server-config-activate /path/to/saved/pbench-server.cfg
pbench-server-activate /opt/pbench-server/lib/config/pbench-server.cfg
</pre>
<p>
The first script copies the config file(s) to the standard place
<code>/opt/pbench-server/lib/config/</code>. N.B. the name <code>pbench-server.cfg</code> is
fixed: there <b>must</b> be a file of that name in
<code>/opt/pbench-server/lib/config/</code> at the end of this step and it is
<b>the</b> config file that is used in the second step, and is made
available to the cron jobs.
</p>

<p>
The second step consists of a number of substeps:
</p>
<ul class="org-ul">
<li>Create the crontab, based on the roles and tasks defined in the
config file. The crontab is <b>not</b> activated: you should examine it
carefully and, assuming that it passes muster, activate it (see below).</li>
<li>Create the results host info structure that the agent depends on to
send results to the server.</li>
<li>Create a directory structure to store results, by default under
<code>/pbench</code>. It is up to you to make sure that there is enough space
there for the results that will be generated by your users.</li>
</ul>

<p>
The final step is to manually activate the crontab (as user <code>pbench</code>,
<b>not</b> as root):
</p>
<pre class="example">
su - pbench
crontab /opt/pbench-server/lib/crontab/crontab
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcf6b88b" class="outline-2">
<h2 id="orgcf6b88b">Testing</h2>
<div class="outline-text-2" id="text-orgcf6b88b">
<p>
You should then test the whole shebang by setting up a <code>pbench-agent</code>
(see <a href="../agent/installation.html">PBench agent installation</a>), running a simple benchmark and moving
the results to the server (see the <a href="../agent/user-guide.html">PBench agent user guide</a> for
details).  Watch the log files on the server (<code>/pbench/logs</code> and
subdirs thereof by default) to make sure that all stages of processing
are correctly done.
</p>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
Although this document describes installation in terms of an "internal"
package, note that that may be a convenient fiction. If there <b>is</b> one available,
then installing it should take care of the config files and the rest of the setup
described in <a href="#orgb6bdb74">Server installation (generic)</a>.
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<p class="date">Page updated: 2018-05-11 Fri 19:30</p>
</div>
</body>
</html>
